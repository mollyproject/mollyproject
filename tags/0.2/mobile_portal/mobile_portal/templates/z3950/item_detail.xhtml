{% extends "z3950/base.xhtml" %}

{% block breadcrumbs %}
{{ block.super }}
            <li><a href="{% url z3950_index %}">
                <img src="{{ MEDIA_URL }}png/index-icons/z3950-bc.png" alt="Library"/>
            </a></li>
{% endblock %}

{% block pagetitle %}View{% endblock %}
{% block title %}m.ox | {{ item.title }}{% endblock %}

{% block content %}

<div class="section-nopad">
    <h2 class="section-header">{{ item.title }}</h2>
    <table class="section-table">
{% if item.author %}
        <tr>
            <th>Author:</th>
            <td>{{ item.author }}</td>
        </tr>
{% endif %}
{% if item.publisher %}
        <tr>
            <th>Publisher:</th>
            <td>{{ item.publisher }}</td>
        </tr>
{% endif %}
{% if item.edition %}
        <tr>
            <th>Edition:</th>
            <td>{{ item.edition }}</td>
        </tr>
{% endif %}
{% if item.description %}
        <tr>
            <th>Description:</th>
            <td>{{ item.description }}</td>
        </tr>
{% endif %}
{% if item.isbns %}
{% for isbn in item.isbns %}
        <tr>
{% if forloop.first %}
            <th{% ifnotequal item.isbns|length 1 %} rowspan="{{ item.isbns|length }}"{% endifnotequal %}>ISBN{{ item.isbns|pluralize }}:</th>
{% endif %}
            <td>{{ isbn }}</td>
        </tr>
{% endfor %}
{% endif %}
{% if item.issns %}
{% for issn in item.issns %}
        <tr>
{% if forloop.first %}
            <th{% ifnotequal item.issns|length 1 %} rowspan="{{ item.issns|length }}"{% endifnotequal %}>ISSN{{ item.issns|pluralize }}:</th>
{% endif %}
            <td>{{ issn }}</td>
        </tr>
{% endfor %}
{% endif %}
    </table>
</div>

{% if libraries %}
<div class="list-section">
    <h2 class="section-header">Library holdings{% if map_hash %} by proximity{% endif %}</h2>
    <div class="list-note"><div class="bubble">
        Please note that all libraries have admission and borrowing policies; inclusion in this list does not imply access.{% if map_hash %} Closest results are not necessarily best.{% endif %}
    </div></div> 

{% if map_hash %}
    <div class="backgrounded-image" style="background-image:url('{% url osm_generated_map map_hash %}'); height:{{ device.max_image_height }}px;"> </div>
{% endif %}

    <ul class="ml">
{% for library, books in libraries %}
{% if library.oxpoints_id %}
        <li><a href="{{ library.oxpoints_entity.get_absolute_url }}">{% if map_hash %}{{ library.marker_number|default_if_none:"Not on map" }}. {% endif %}{{ library.location|join:" - " }}</a></li>
{% else %}
        <li class="non-link-item">{% if map_hash %}{{ library.marker_number|default_if_none:"Not on map" }}. {% endif %}{{ library.location|join:" - " }}</li>
{% endif %}
{% ifequal books|length 1 %}
    <li class="subitem non-link-item">
    Shelfmark: <em>{{ books.0.shelfmark }}</em>, availability: <em>{{ books.0.availability_display }}</em>{% if books.0.materials_specified %}, issue: <em>{{ books.0.materials_specified }}</em>{% endif %}
    </li>
{% else %}
    <li class="subitem">
      <a href="{% url z3950_item_holdings_detail control_number,library.location.1 %}">
        {{ books|length }} items with availability at most <em>{{ library.availability_display }}</em>
      </a>
{% endifequal %}
{% endfor %}
    </ul>
</div>
{% endif %}

{% if stacks %}
<div class="list-section">
    <h2 class="section-header">Holdings in stacks</h2>
    <ul class="ml">
{% for library, books in stacks %}
{% if library.oxpoints_id %}
        <li><a href="{{ library.oxpoints_entity.get_absolute_url }}">{{ forloop.counter }}. {{ library.location|join:" - " }}</a></li>
{% else %}
        <li class="non-link-item">{{ forloop.counter }}. {{ library.location|join:" - " }}</li>
{% endif %}
        {% for book in books %}
        <li class="subitem non-link-item">
        Shelfmark: <em>{{ book.shelfmark }}</em>, availability: <em>{{ book.availability_display }}</em>{% if book.materials_specified %}, issue: <em>{{ book.materials_specified }}</em>{% endif %}
        </li>
        {% endfor %}
{% endfor %}
    </ul>
</div>
{% endif %}

{% endblock %}
